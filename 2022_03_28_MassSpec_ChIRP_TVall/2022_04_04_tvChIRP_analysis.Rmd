---
title: "2022_03_28_AllTVChIRPdata"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
library(tidyverse)
library(rstatix)
library(ggpubr)
library(dplyr)
library(purrr)
library(janitor)
library(ggplot2)
library(ggvenn)
library(VennDiagram)
library(venneuler)
library(eulerr)
library(reshape)
knitr::opts_chunk$set(echo = TRUE)
```

#Making Tibbles of Intensities for each protein from the March 2022 only including only those with 
#Wt hits (out = only KO and input)
```{r}

#Mar2022 Kit Data
mass_spec_50ng_Mar2022_TV <- read_csv("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall/2022_03_24_50ng_protein_ChIRP_5percentFDR_JRinn.csv") %>% clean_names()
mass_spec_100ng_Mar2022_TV <- read_csv("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall/2022_03_24_100ng_ChIRP_5percentFDR_JRinn_Results.csv") %>% clean_names()

#Jan2022TVkit Data Same thing. 
kit_mass_spec_Jan2022_TV <- read_csv("/scratch/Shares/rinn/tenaya/ChChCh/2022_02_01_FirreMassSpecData_Analysis/2022_01_31_SCP_TVallery_combined_proteins.csv") %>% clean_names()

KO_intensities_mass_spec_Jan2022_TV <- kit_mass_spec_Jan2022_TV[,c(4,17,18)]
colnames(KO_intensities_mass_spec_Jan2022_TV)[2:3] <- paste(colnames(KO_intensities_mass_spec_Jan2022_TV)[2:3],"Jan2022",sep=".")
WT_intensities_mass_spec_Jan2022_TV <- kit_mass_spec_Jan2022_TV[,c(4,19,20)]
colnames(WT_intensities_mass_spec_Jan2022_TV)[2:3] <- paste(colnames(WT_intensities_mass_spec_Jan2022_TV)[2:3],"Jan2022",sep=".")


#Need to do a few things
#First I am going to filter out the input entries and KO entries so that we only have the WT significant entries. I will do this by focus on WT intensities, sum the rows, then filter out any sums that are contain zero. 

Intensities_50ng <- mass_spec_50ng_Mar2022_TV[,c(4,34,35,36,37,38)]
colnames(Intensities_50ng)[2:6] <- paste(colnames(Intensities_50ng)[2:6],"50ng",sep=".")
Intensities_100ng <- mass_spec_100ng_Mar2022_TV[,c(4,34,35,36,37,38)]
colnames(Intensities_100ng)[2:6] <- paste(colnames(Intensities_100ng)[2:6],"100ng",sep=".")
Intensities <- full_join(Intensities_50ng,Intensities_100ng,by="gene",copy=FALSE,keep = FALSE)
Intensities <- as.data.frame(Intensities)

#March 2022 WT Check Set up
Intensities_50ng_WTcheck <- Intensities_50ng[,c(1,3,5,6)]
Intensities_100ng_WTcheck <- Intensities_100ng[,c(1,3,5,6)]
Intensities_WTcheck <- full_join(Intensities_50ng_WTcheck,Intensities_100ng_WTcheck,by="gene",copy=FALSE,keep = FALSE)
Intensities_WTcheck <- as.data.frame(Intensities_WTcheck)
Intensities_WTcheckA <- Intensities_WTcheck %>% replace_na(list(r2_wt_oe_intensity.50ng = 0, r3_wt_oe_intensity.50ng = 0, r4_wt_oe_intensity.50ng=0, r2_wt_oe_intensity.100ng=0, r3_wt_oe_intensity.100ng=0, r4_wt_oe_intensity.100ng=0))

#Mar and Jan 2022 WT Check Set Up
Intensities_WTcheck_withJan2022 <- full_join(Intensities_WTcheck, WT_intensities_mass_spec_Jan2022_TV,by="gene",copy=FALSE,keep = FALSE)
Intensities_WTcheck_withJan2022 <- as.data.frame(Intensities_WTcheck_withJan2022)
Intensities_WTcheck_withJan2022_A <- Intensities_WTcheck_withJan2022 %>% replace_na(list(r2_wt_oe_intensity.50ng = 0, r3_wt_oe_intensity.50ng = 0, r4_wt_oe_intensity.50ng=0, r2_wt_oe_intensity.100ng=0, r3_wt_oe_intensity.100ng=0, r4_wt_oe_intensity.100ng=0, wt_0h_even_total_intensity.Jan2022=0, wt_0h_odd_total_intensity.Jan2022=0))

#New WTcheck
#Removing columns with any zeros in them
#https://statisticsglobe.com/remove-rows-with-any-zero-in-r
#df[rowSums(df > 10) >= 1, ]

#March2022 WT Check 
Intensities_WT_check_1_out_of_6 <- Intensities_WTcheckA[rowSums(Intensities_WTcheckA > 0) >= 2,]
Intensities_WT_check_2_out_of_6 <- Intensities_WTcheckA[rowSums(Intensities_WTcheckA > 0) >= 3,]
Intensities_WT_check_3_out_of_6 <- Intensities_WTcheckA[rowSums(Intensities_WTcheckA > 0) >= 4,]
Intensities_WT_check_4_out_of_6 <- Intensities_WTcheckA[rowSums(Intensities_WTcheckA > 0) >= 5,]
Intensities_WT_check_5_out_of_6 <- Intensities_WTcheckA[rowSums(Intensities_WTcheckA > 0) >= 6,]
Intensities_WT_check_6_out_of_6 <- Intensities_WTcheckA[rowSums(Intensities_WTcheckA > 0) >= 7,]   

#For each of these I will now add in the KO values with a left_join
#Clean up NAs too 

#1 out of 6
Intensities_ratio_check_1_out_of_6 <- Intensities_WT_check_1_out_of_6 %>% left_join(Intensities_50ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_1_out_of_6 <- Intensities_ratio_check_1_out_of_6 %>% left_join(Intensities_100ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_1_out_of_6 <- Intensities_ratio_check_1_out_of_6%>% replace_na(list(r2_ko_oe_intensity.50ng = 0, r3_ko_oe_intensity.50ng = 0, r2_ko_oe_intensity.100ng=0, r3_ko_oe_intensity.100ng=0))
                                                        
#2 out of 6
Intensities_ratio_check_2_out_of_6 <- Intensities_WT_check_2_out_of_6 %>% left_join(Intensities_50ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_2_out_of_6 <- Intensities_ratio_check_2_out_of_6 %>% left_join(Intensities_100ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_2_out_of_6 <- Intensities_ratio_check_2_out_of_6%>% replace_na(list(r2_ko_oe_intensity.50ng = 0, r3_ko_oe_intensity.50ng = 0, r2_ko_oe_intensity.100ng=0, r3_ko_oe_intensity.100ng=0))

#3 out of 6
Intensities_ratio_check_3_out_of_6 <- Intensities_WT_check_3_out_of_6 %>% left_join(Intensities_50ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_3_out_of_6 <- Intensities_ratio_check_3_out_of_6 %>% left_join(Intensities_100ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_3_out_of_6 <- Intensities_ratio_check_3_out_of_6%>% replace_na(list(r2_ko_oe_intensity.50ng = 0, r3_ko_oe_intensity.50ng = 0, r2_ko_oe_intensity.100ng=0, r3_ko_oe_intensity.100ng=0))

#4 out of 6
Intensities_ratio_check_4_out_of_6 <- Intensities_WT_check_4_out_of_6 %>% left_join(Intensities_50ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_4_out_of_6 <- Intensities_ratio_check_4_out_of_6 %>% left_join(Intensities_100ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_4_out_of_6 <- Intensities_ratio_check_4_out_of_6%>% replace_na(list(r2_ko_oe_intensity.50ng = 0, r3_ko_oe_intensity.50ng = 0, r2_ko_oe_intensity.100ng=0, r3_ko_oe_intensity.100ng=0))

#5 out of 6
Intensities_ratio_check_5_out_of_6 <- Intensities_WT_check_5_out_of_6 %>% left_join(Intensities_50ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_5_out_of_6 <- Intensities_ratio_check_5_out_of_6 %>% left_join(Intensities_100ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_5_out_of_6 <- Intensities_ratio_check_5_out_of_6%>% replace_na(list(r2_ko_oe_intensity.50ng = 0, r3_ko_oe_intensity.50ng = 0, r2_ko_oe_intensity.100ng=0, r3_ko_oe_intensity.100ng=0))

#6 out of 6
Intensities_ratio_check_6_out_of_6 <- Intensities_WT_check_6_out_of_6 %>% left_join(Intensities_50ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_6_out_of_6 <- Intensities_ratio_check_6_out_of_6 %>% left_join(Intensities_100ng[,c(1,2,4)],by="gene")
Intensities_ratio_check_6_out_of_6 <- Intensities_ratio_check_6_out_of_6%>% replace_na(list(r2_ko_oe_intensity.50ng = 0, r3_ko_oe_intensity.50ng = 0, r2_ko_oe_intensity.100ng=0, r3_ko_oe_intensity.100ng=0))


#Now we can't have zeros for the ratio check
#make a column of KO mean for Rep 4 ratio

#1 out of 6
Intensities_ratio_check_1_out_of_6_nonzero <- Intensities_ratio_check_1_out_of_6 %>% map_if(is.numeric, ~.+1)
Intensities_ratio_check_1_out_of_6_nonzero <- as.data.frame(Intensities_ratio_check_1_out_of_6_nonzero)
Intensities_ratio_check_1_out_of_6_nonzero$ko_mean <- rowMeans(subset(Intensities_ratio_check_1_out_of_6_nonzero, select = c(r2_ko_oe_intensity.50ng, r3_ko_oe_intensity.50ng,r2_ko_oe_intensity.100ng,r3_ko_oe_intensity.100ng)),)

#2 out of 6
Intensities_ratio_check_2_out_of_6_nonzero <- Intensities_ratio_check_2_out_of_6 %>% map_if(is.numeric, ~.+1)
Intensities_ratio_check_2_out_of_6_nonzero <- as.data.frame(Intensities_ratio_check_2_out_of_6_nonzero)
Intensities_ratio_check_2_out_of_6_nonzero$ko_mean <- rowMeans(subset(Intensities_ratio_check_2_out_of_6_nonzero, select = c(r2_ko_oe_intensity.50ng, r3_ko_oe_intensity.50ng,r2_ko_oe_intensity.100ng,r3_ko_oe_intensity.100ng)),)

#3 out of 6
Intensities_ratio_check_3_out_of_6_nonzero <- Intensities_ratio_check_3_out_of_6 %>% map_if(is.numeric, ~.+1)
Intensities_ratio_check_3_out_of_6_nonzero <- as.data.frame(Intensities_ratio_check_3_out_of_6_nonzero)
Intensities_ratio_check_3_out_of_6_nonzero$ko_mean <- rowMeans(subset(Intensities_ratio_check_3_out_of_6_nonzero, select = c(r2_ko_oe_intensity.50ng, r3_ko_oe_intensity.50ng,r2_ko_oe_intensity.100ng,r3_ko_oe_intensity.100ng)),)

#4 out of 6
Intensities_ratio_check_4_out_of_6_nonzero <- Intensities_ratio_check_4_out_of_6 %>% map_if(is.numeric, ~.+1)
Intensities_ratio_check_4_out_of_6_nonzero <- as.data.frame(Intensities_ratio_check_4_out_of_6_nonzero)
Intensities_ratio_check_4_out_of_6_nonzero$ko_mean <- rowMeans(subset(Intensities_ratio_check_4_out_of_6_nonzero, select = c(r2_ko_oe_intensity.50ng, r3_ko_oe_intensity.50ng,r2_ko_oe_intensity.100ng,r3_ko_oe_intensity.100ng)),)

#5 out of 6
Intensities_ratio_check_5_out_of_6_nonzero <- Intensities_ratio_check_5_out_of_6 %>% map_if(is.numeric, ~.+1)
Intensities_ratio_check_5_out_of_6_nonzero <- as.data.frame(Intensities_ratio_check_5_out_of_6_nonzero)
Intensities_ratio_check_5_out_of_6_nonzero$ko_mean <- rowMeans(subset(Intensities_ratio_check_5_out_of_6_nonzero, select = c(r2_ko_oe_intensity.50ng, r3_ko_oe_intensity.50ng,r2_ko_oe_intensity.100ng,r3_ko_oe_intensity.100ng)),)

#6 out of 6
Intensities_ratio_check_6_out_of_6_nonzero <- Intensities_ratio_check_6_out_of_6 %>% map_if(is.numeric, ~.+1)
Intensities_ratio_check_6_out_of_6_nonzero <- as.data.frame(Intensities_ratio_check_6_out_of_6_nonzero)
Intensities_ratio_check_6_out_of_6_nonzero$ko_mean <- rowMeans(subset(Intensities_ratio_check_6_out_of_6_nonzero, select = c(r2_ko_oe_intensity.50ng, r3_ko_oe_intensity.50ng,r2_ko_oe_intensity.100ng,r3_ko_oe_intensity.100ng)),)


#Now calculate the ratio for each replicate
#Print a histogram of those ratios

#1 out of 6
Intensities_ratio_check_1_out_of_6_nonzero <- Intensities_ratio_check_1_out_of_6_nonzero %>% mutate(intensities_ratio1 = (r2_wt_oe_intensity.50ng/r2_ko_oe_intensity.50ng), intensities_ratio2=(r3_wt_oe_intensity.50ng/r3_ko_oe_intensity.50ng), intensities_ratio3 = (r4_wt_oe_intensity.50ng/ko_mean))
Intensities_ratio_check_1_out_of_6_nonzero$ratio_mean <- rowMeans(subset(Intensities_ratio_check_1_out_of_6_nonzero, select = c(intensities_ratio1, intensities_ratio2,intensities_ratio3)),)
Intensities_ratio_check_1_out_of_6_nonzero$logratio_mean = log(Intensities_ratio_check_1_out_of_6_nonzero$ratio_mean,10)
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_06_1outof6_Histogram_FoldChange_WT_KO_MassSpec_Mar2022TV.pdf")
hist(Intensities_ratio_check_1_out_of_6_nonzero$logratio_mean, breaks = 50, main="(1 out of 6) Frequency of Log Average of Fold Change of WT/KO Intensities \nfrom TVkitMar2022 protein", xlab = "Log Average Fold Change of WT to KO with genes that have at least one WT intensity", ylab = "Frequency of Genes", labels=TRUE) 
dev.off()

#2 out of 6
Intensities_ratio_check_2_out_of_6_nonzero <- Intensities_ratio_check_2_out_of_6_nonzero %>% mutate(intensities_ratio1 = (r2_wt_oe_intensity.50ng/r2_ko_oe_intensity.50ng), intensities_ratio2=(r3_wt_oe_intensity.50ng/r3_ko_oe_intensity.50ng), intensities_ratio3 = (r4_wt_oe_intensity.50ng/ko_mean))
Intensities_ratio_check_2_out_of_6_nonzero$ratio_mean <- rowMeans(subset(Intensities_ratio_check_2_out_of_6_nonzero, select = c(intensities_ratio1, intensities_ratio2,intensities_ratio3)),)
Intensities_ratio_check_2_out_of_6_nonzero$logratio_mean = log(Intensities_ratio_check_2_out_of_6_nonzero$ratio_mean,10)
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_06_2outof6_Histogram_FoldChange_WT_KO_MassSpec_Mar2022TV.pdf")
hist(Intensities_ratio_check_2_out_of_6_nonzero$logratio_mean, breaks = 50, main="(2 out of 6) Frequency of Log Average of Fold Change of WT/KO Intensities \nfrom TVkitMar2022 protein", xlab = "Log Average Fold Change of WT to KO with genes that have at least one WT intensity", ylab = "Frequency of Genes", labels=TRUE) 
dev.off()

#3 out of 6
Intensities_ratio_check_3_out_of_6_nonzero <- Intensities_ratio_check_3_out_of_6_nonzero %>% mutate(intensities_ratio1 = (r2_wt_oe_intensity.50ng/r2_ko_oe_intensity.50ng), intensities_ratio2=(r3_wt_oe_intensity.50ng/r3_ko_oe_intensity.50ng), intensities_ratio3 = (r4_wt_oe_intensity.50ng/ko_mean))
Intensities_ratio_check_3_out_of_6_nonzero$ratio_mean <- rowMeans(subset(Intensities_ratio_check_3_out_of_6_nonzero, select = c(intensities_ratio1, intensities_ratio2,intensities_ratio3)),)
Intensities_ratio_check_3_out_of_6_nonzero$logratio_mean = log(Intensities_ratio_check_3_out_of_6_nonzero$ratio_mean,10)
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_06_3outof6_Histogram_FoldChange_WT_KO_MassSpec_Mar2022TV.pdf")
hist(Intensities_ratio_check_3_out_of_6_nonzero$logratio_mean, breaks = 50, main="(3 out of 6) Frequency of Log Average of Fold Change of WT/KO Intensities \nfrom TVkitMar2022 protein", xlab = "Log Average Fold Change of WT to KO with genes that have at least one WT intensity", ylab = "Frequency of Genes", labels=TRUE) 
dev.off()

#4 out of 6
Intensities_ratio_check_4_out_of_6_nonzero <- Intensities_ratio_check_4_out_of_6_nonzero %>% mutate(intensities_ratio1 = (r2_wt_oe_intensity.50ng/r2_ko_oe_intensity.50ng), intensities_ratio2=(r3_wt_oe_intensity.50ng/r3_ko_oe_intensity.50ng), intensities_ratio3 = (r4_wt_oe_intensity.50ng/ko_mean))
Intensities_ratio_check_4_out_of_6_nonzero$ratio_mean <- rowMeans(subset(Intensities_ratio_check_4_out_of_6_nonzero, select = c(intensities_ratio1, intensities_ratio2,intensities_ratio3)),)
Intensities_ratio_check_4_out_of_6_nonzero$logratio_mean = log(Intensities_ratio_check_4_out_of_6_nonzero$ratio_mean,10)
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_06_4outof6_Histogram_FoldChange_WT_KO_MassSpec_Mar2022TV.pdf")
hist(Intensities_ratio_check_4_out_of_6_nonzero$logratio_mean, breaks = 50, main="(4 out of 6) Frequency of Log Average of Fold Change of WT/KO Intensities \nfrom TVkitMar2022 protein", xlab = "Log Average Fold Change of WT to KO with genes that have at least one WT intensity", ylab = "Frequency of Genes", labels=TRUE) 
dev.off()

#5 out of 6
Intensities_ratio_check_5_out_of_6_nonzero <- Intensities_ratio_check_5_out_of_6_nonzero %>% mutate(intensities_ratio1 = (r2_wt_oe_intensity.50ng/r2_ko_oe_intensity.50ng), intensities_ratio2=(r3_wt_oe_intensity.50ng/r3_ko_oe_intensity.50ng), intensities_ratio3 = (r4_wt_oe_intensity.50ng/ko_mean))
Intensities_ratio_check_5_out_of_6_nonzero$ratio_mean <- rowMeans(subset(Intensities_ratio_check_5_out_of_6_nonzero, select = c(intensities_ratio1, intensities_ratio2,intensities_ratio3)),)
Intensities_ratio_check_5_out_of_6_nonzero$logratio_mean = log(Intensities_ratio_check_5_out_of_6_nonzero$ratio_mean,10)
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_06_5outof6_Histogram_FoldChange_WT_KO_MassSpec_Mar2022TV.pdf")
hist(Intensities_ratio_check_5_out_of_6_nonzero$logratio_mean, breaks = 50, main="(5 out of 6) Frequency of Log Average of Fold Change of WT/KO Intensities \nfrom TVkitMar2022 protein", xlab = "Log Average Fold Change of WT to KO with genes that have at least one WT intensity", ylab = "Frequency of Genes", labels=TRUE) 
dev.off()

#6 out of 6
Intensities_ratio_check_6_out_of_6_nonzero <- Intensities_ratio_check_6_out_of_6_nonzero %>% mutate(intensities_ratio1 = (r2_wt_oe_intensity.50ng/r2_ko_oe_intensity.50ng), intensities_ratio2=(r3_wt_oe_intensity.50ng/r3_ko_oe_intensity.50ng), intensities_ratio3 = (r4_wt_oe_intensity.50ng/ko_mean))
Intensities_ratio_check_6_out_of_6_nonzero$ratio_mean <- rowMeans(subset(Intensities_ratio_check_6_out_of_6_nonzero, select = c(intensities_ratio1, intensities_ratio2,intensities_ratio3)),)
Intensities_ratio_check_6_out_of_6_nonzero$logratio_mean = log(Intensities_ratio_check_6_out_of_6_nonzero$ratio_mean,10)
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_06_6outof6_Histogram_FoldChange_WT_KO_MassSpec_Mar2022TV.pdf")
hist(Intensities_ratio_check_6_out_of_6_nonzero$logratio_mean, breaks = 50, main="(6 out of 6) Frequency of Log Average of Fold Change of WT/KO Intensities \nfrom TVkitMar2022 protein", xlab = "Log Average Fold Change of WT to KO with genes that have at least one WT intensity", ylab = "Frequency of Genes", labels=TRUE) 
dev.off()

#Need to filter out those with ratios below 1.5
#Getting ready for the Wilcoxon Test

#1 out of 6
Intensities_ratiovalid_1_out_of_6 <- dplyr::filter(Intensities_ratio_check_1_out_of_6_nonzero, ratio_mean > 1.1)
intensities_validgenenames_1_out_of_6 <- Intensities_ratiovalid_1_out_of_6$gene
pattern_to_search_1outof6 <- paste0(intensities_validgenenames_1_out_of_6, collapse = "$|^")
pattern_to_search_1outof6 <- paste("^",pattern_to_search_1outof6,"$",sep="")
Intensities_1_out_of_6 <- Intensities_ratio_check_1_out_of_6[grepl(pattern_to_search_1outof6, Intensities_ratio_check_1_out_of_6$gene),]
Intensities_1_out_of_6_ready <- as.data.frame(t(Intensities_1_out_of_6 ))
Intensities_newcol <- c("genotype","WT","WT","WT","WT","WT","WT","KO","KO","KO","KO")
Intensities_1_out_of_6_ready <- cbind(Intensities_newcol,Intensities_1_out_of_6_ready)
Intensities_1_out_of_6_ready<-Intensities_1_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_1_out_of_6_ready[] <- lapply(Intensities_1_out_of_6_ready, type.convert, as.is = TRUE)

#2 out of 6
Intensities_ratiovalid_2_out_of_6 <- dplyr::filter(Intensities_ratio_check_2_out_of_6_nonzero, ratio_mean > 1.1)
intensities_validgenenames_2_out_of_6 <- Intensities_ratiovalid_2_out_of_6$gene
pattern_to_search_2outof6 <- paste0(intensities_validgenenames_2_out_of_6, collapse = "$|^")
pattern_to_search_2outof6 <- paste("^",pattern_to_search_2outof6,"$",sep="")
Intensities_2_out_of_6 <- Intensities_ratio_check_2_out_of_6[grepl(pattern_to_search_2outof6, Intensities_ratio_check_2_out_of_6$gene),]
Intensities_2_out_of_6_ready <- as.data.frame(t(Intensities_2_out_of_6 ))
Intensities_2_out_of_6_ready <- cbind(Intensities_newcol,Intensities_2_out_of_6_ready)
Intensities_2_out_of_6_ready<-Intensities_2_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_2_out_of_6_ready[] <- lapply(Intensities_2_out_of_6_ready, type.convert, as.is = TRUE)

#3 out of 6
Intensities_ratiovalid_3_out_of_6 <- dplyr::filter(Intensities_ratio_check_3_out_of_6_nonzero, ratio_mean > 1.1)
intensities_validgenenames_3_out_of_6 <- Intensities_ratiovalid_3_out_of_6$gene
pattern_to_search_3outof6 <- paste0(intensities_validgenenames_3_out_of_6, collapse = "$|^")
pattern_to_search_3outof6 <- paste("^",pattern_to_search_3outof6,"$",sep="")
Intensities_3_out_of_6 <- Intensities_ratio_check_3_out_of_6[grepl(pattern_to_search_3outof6, Intensities_ratio_check_3_out_of_6$gene),]
Intensities_3_out_of_6_ready <- as.data.frame(t(Intensities_3_out_of_6 ))
Intensities_3_out_of_6_ready <- cbind(Intensities_newcol,Intensities_3_out_of_6_ready)
Intensities_3_out_of_6_ready<-Intensities_3_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_3_out_of_6_ready[] <- lapply(Intensities_3_out_of_6_ready, type.convert, as.is = TRUE)

#4 out of 6
Intensities_ratiovalid_4_out_of_6 <- dplyr::filter(Intensities_ratio_check_4_out_of_6_nonzero, ratio_mean > 1.1)
intensities_validgenenames_4_out_of_6 <- Intensities_ratiovalid_4_out_of_6$gene
pattern_to_search_4outof6 <- paste0(intensities_validgenenames_4_out_of_6, collapse = "$|^")
pattern_to_search_4outof6 <- paste("^",pattern_to_search_4outof6,"$",sep="")
Intensities_4_out_of_6 <- Intensities_ratio_check_4_out_of_6[grepl(pattern_to_search_4outof6, Intensities_ratio_check_4_out_of_6$gene),]
Intensities_4_out_of_6_ready <- as.data.frame(t(Intensities_4_out_of_6 ))
Intensities_4_out_of_6_ready <- cbind(Intensities_newcol,Intensities_4_out_of_6_ready)
Intensities_4_out_of_6_ready<-Intensities_4_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_4_out_of_6_ready[] <- lapply(Intensities_4_out_of_6_ready, type.convert, as.is = TRUE)

#5 out of 6
Intensities_ratiovalid_5_out_of_6 <- dplyr::filter(Intensities_ratio_check_5_out_of_6_nonzero, ratio_mean > 1.1)
intensities_validgenenames_5_out_of_6 <- Intensities_ratiovalid_5_out_of_6$gene
pattern_to_search_5outof6 <- paste0(intensities_validgenenames_5_out_of_6, collapse = "$|^")
pattern_to_search_5outof6 <- paste("^",pattern_to_search_5outof6,"$",sep="")
Intensities_5_out_of_6 <- Intensities_ratio_check_5_out_of_6[grepl(pattern_to_search_5outof6, Intensities_ratio_check_5_out_of_6$gene),]
Intensities_5_out_of_6_ready <- as.data.frame(t(Intensities_5_out_of_6 ))
Intensities_5_out_of_6_ready <- cbind(Intensities_newcol,Intensities_5_out_of_6_ready)
Intensities_5_out_of_6_ready<-Intensities_5_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_5_out_of_6_ready[] <- lapply(Intensities_5_out_of_6_ready, type.convert, as.is = TRUE)

#6 out of 6
Intensities_ratiovalid_6_out_of_6 <- dplyr::filter(Intensities_ratio_check_6_out_of_6_nonzero, ratio_mean > 1.1)
intensities_validgenenames_6_out_of_6 <- Intensities_ratiovalid_6_out_of_6$gene
pattern_to_search_6outof6 <- paste0(intensities_validgenenames_6_out_of_6, collapse = "$|^")
pattern_to_search_6outof6 <- paste("^",pattern_to_search_6outof6,"$",sep="")
Intensities_6_out_of_6 <- Intensities_ratio_check_6_out_of_6[grepl(pattern_to_search_6outof6, Intensities_ratio_check_6_out_of_6$gene),]
Intensities_6_out_of_6_ready <- as.data.frame(t(Intensities_6_out_of_6 ))
Intensities_6_out_of_6_ready <- cbind(Intensities_newcol,Intensities_6_out_of_6_ready)
Intensities_6_out_of_6_ready<-Intensities_6_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_6_out_of_6_ready[] <- lapply(Intensities_6_out_of_6_ready, type.convert, as.is = TRUE)
```

##Need to change below gene to do a check. 
```{r}
typeof(Intensities_1_out_of_6_ready$actb)
typeof(Intensities_2_out_of_6_ready$actb)
typeof(Intensities_3_out_of_6_ready$actb)
typeof(Intensities_4_out_of_6_ready$actb)
typeof(Intensities_5_out_of_6_ready$actb)
typeof(Intensities_6_out_of_6_ready$actb)

```

#Wilcoxon Test on each of the Intensities Conditional Sort 
#Output is a csv file to have the pvalues in a table format. 
```{r}
#1 out of 6
test.fun1 <- function(Intensities_1_out_of_6_ready, col) { 

 c1 <- combn(unique(Intensities_1_out_of_6_ready$genotype),2)
 sigs1 <- list()
 for(i in 1:ncol(c1)) {
    sigs1[[i]] <- wilcox_test(
                   Intensities_1_out_of_6_ready[Intensities_1_out_of_6_ready$genotype == c1[1,i],col],
                   Intensities_1_out_of_6_ready[Intensities_1_out_of_6_ready$genotype == c1[2,i],col], exact = FALSE
                 )
    }
    names(sigs1) <- paste("Group",c1[1,],"by Group",c1[2,])

 tests_Intensities_1_out_of_6_Mar2022 <- data.frame(Test=names(sigs1),
                    W=unlist(lapply(sigs1,function(x) x$statistic)),
                    p=unlist(lapply(sigs1,function(x) x$p.value)),row.names=NULL)

 return(tests_Intensities_1_out_of_6_Mar2022)
}


tests_Intensities_1_out_of_6_Mar2022 <- lapply(colnames(Intensities_1_out_of_6_ready)[-1],function(x) test.fun(Intensities_1_out_of_6_ready,x))
names(tests_Intensities_1_out_of_6_Mar2022) <- colnames(Intensities_1_out_of_6_ready)[-1]
results_Intensities_1_out_of_6_Mar2022 <- do.call(rbind.data.frame, tests_Intensities_1_out_of_6_Mar2022)
write.csv(results_Intensities_1_out_of_6_Mar2022,"/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_results_Intensities_1_out_of_6_Mar2022.csv",row.names = TRUE)



#2 out of 6
test.fun2 <- function(Intensities_2_out_of_6_ready, col) { 

 c2 <- combn(unique(Intensities_2_out_of_6_ready$genotype),2)
 sigs2 <- list()
 for(i in 1:ncol(c2)) {
    sigs2[[i]] <- wilcox.test(
                   Intensities_2_out_of_6_ready[Intensities_2_out_of_6_ready$genotype == c2[1,i],col],
                   Intensities_2_out_of_6_ready[Intensities_2_out_of_6_ready$genotype == c2[2,i],col], exact=FALSE
                 )
    }
    names(sigs2) <- paste("Group",c2[1,],"by Group",c2[2,])

 tests_Intensities_2_out_of_6_Mar2022 <- data.frame(Test=names(sigs2),
                    W=unlist(lapply(sigs2,function(x) x$statistic)),
                    p=unlist(lapply(sigs2,function(x) x$p.value)),row.names=NULL)

 return(tests_Intensities_2_out_of_6_Mar2022)
}


tests_Intensities_2_out_of_6_Mar2022 <- lapply(colnames(Intensities_2_out_of_6_ready)[-1],function(x) test.fun(Intensities_2_out_of_6_ready,x))
names(tests_Intensities_2_out_of_6_Mar2022) <- colnames(Intensities_2_out_of_6_ready)[-1]
results_Intensities_2_out_of_6_Mar2022 <- do.call(rbind.data.frame, tests_Intensities_2_out_of_6_Mar2022)
write.csv(results_Intensities_2_out_of_6_Mar2022,"/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_results_Intensities_2_out_of_6_Mar2022.csv",row.names = TRUE)

#3 out of 6
test.fun3 <- function(Intensities_3_out_of_6_ready, col) { 

 c3 <- combn(unique(Intensities_3_out_of_6_ready$genotype),2)
 sigs3 <- list()
 for(i in 1:ncol(c3)) {
    sigs3[[i]] <- wilcox.test(
                   Intensities_3_out_of_6_ready[Intensities_3_out_of_6_ready$genotype == c3[1,i],col],
                   Intensities_3_out_of_6_ready[Intensities_3_out_of_6_ready$genotype == c3[2,i],col], exact=FALSE
                 )
    }
    names(sigs3) <- paste("Group",c3[1,],"by Group",c3[2,])

 tests_Intensities_3_out_of_6_Mar2022 <- data.frame(Test=names(sigs3),
                    W=unlist(lapply(sigs3,function(x) x$statistic)),
                    p=unlist(lapply(sigs3,function(x) x$p.value)),row.names=NULL)

 return(tests_Intensities_3_out_of_6_Mar2022)
}


tests_Intensities_3_out_of_6_Mar2022 <- lapply(colnames(Intensities_3_out_of_6_ready)[-1],function(x) test.fun(Intensities_3_out_of_6_ready,x))
names(tests_Intensities_3_out_of_6_Mar2022) <- colnames(Intensities_3_out_of_6_ready)[-1]
results_Intensities_3_out_of_6_Mar2022 <- do.call(rbind.data.frame, tests_Intensities_3_out_of_6_Mar2022)
write.csv(results_Intensities_3_out_of_6_Mar2022,"/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_results_Intensities_3_out_of_6_Mar2022.csv",row.names = TRUE)


#4 out of 6
test.fun4 <- function(Intensities_4_out_of_6_ready, col) { 

 c4 <- combn(unique(Intensities_4_out_of_6_ready$genotype),2)
 sigs4 <- list()
 for(i in 1:ncol(c4)) {
    sigs4[[i]] <- wilcox.test(
                   Intensities_4_out_of_6_ready[Intensities_4_out_of_6_ready$genotype == c4[1,i],col],
                   Intensities_4_out_of_6_ready[Intensities_4_out_of_6_ready$genotype == c4[2,i],col], exact=FALSE
                 )
    }
    names(sigs4) <- paste("Group",c4[1,],"by Group",c4[2,])

 tests_Intensities_4_out_of_6_Mar2022 <- data.frame(Test=names(sigs4),
                    W=unlist(lapply(sigs4,function(x) x$statistic)),
                    p=unlist(lapply(sigs4,function(x) x$p.value)),row.names=NULL)

 return(tests_Intensities_4_out_of_6_Mar2022)
}


tests_Intensities_4_out_of_6_Mar2022 <- lapply(colnames(Intensities_4_out_of_6_ready)[-1],function(x) test.fun(Intensities_4_out_of_6_ready,x))
names(tests_Intensities_4_out_of_6_Mar2022) <- colnames(Intensities_4_out_of_6_ready)[-1]
results_Intensities_4_out_of_6_Mar2022 <- do.call(rbind.data.frame, tests_Intensities_4_out_of_6_Mar2022)
write.csv(results_Intensities_4_out_of_6_Mar2022,"/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_results_Intensities_4_out_of_6_Mar2022.csv",row.names = TRUE)

#5 out of 6
test.fun5 <- function(Intensities_5_out_of_6_ready, col) { 

 c5 <- combn(unique(Intensities_5_out_of_6_ready$genotype),2)
 sigs5 <- list()
 for(i in 1:ncol(c5)) {
    sigs5[[i]] <- wilcox.test(
                   Intensities_5_out_of_6_ready[Intensities_5_out_of_6_ready$genotype == c5[1,i],col],
                   Intensities_5_out_of_6_ready[Intensities_5_out_of_6_ready$genotype == c5[2,i],col], exact=FALSE
                 )
    }
    names(sigs5) <- paste("Group",c5[1,],"by Group",c5[2,])

 tests_Intensities_5_out_of_6_Mar2022 <- data.frame(Test=names(sigs5),
                    W=unlist(lapply(sigs5,function(x) x$statistic)),
                    p=unlist(lapply(sigs5,function(x) x$p.value)),row.names=NULL)

 return(tests_Intensities_5_out_of_6_Mar2022)
}


tests_Intensities_5_out_of_6_Mar2022 <- lapply(colnames(Intensities_5_out_of_6_ready)[-1],function(x) test.fun(Intensities_5_out_of_6_ready,x))
names(tests_Intensities_5_out_of_6_Mar2022) <- colnames(Intensities_5_out_of_6_ready)[-1]
results_Intensities_5_out_of_6_Mar2022 <- do.call(rbind.data.frame, tests_Intensities_5_out_of_6_Mar2022)
write.csv(results_Intensities_5_out_of_6_Mar2022,"/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_results_Intensities_5_out_of_6_Mar2022.csv",row.names = TRUE)



#6 out of 6
test.fun6 <- function(Intensities_6_out_of_6_ready, col) { 

 c6 <- combn(unique(Intensities_6_out_of_6_ready$genotype),2)
 sigs6 <- list()
 for(i in 1:ncol(c6)) {
    sigs6[[i]] <- wilcox.test(
                   Intensities_6_out_of_6_ready[Intensities_6_out_of_6_ready$genotype == c6[1,i],col],
                   Intensities_6_out_of_6_ready[Intensities_6_out_of_6_ready$genotype == c6[2,i],col], exact=FALSE
                 )
    }
    names(sigs6) <- paste("Group",c6[1,],"by Group",c6[2,])

 tests_Intensities_6_out_of_6_Mar2022 <- data.frame(Test=names(sigs6),
                    W=unlist(lapply(sigs6,function(x) x$statistic)),
                    p=unlist(lapply(sigs6,function(x) x$p.value)),row.names=NULL)

 return(tests_Intensities_6_out_of_6_Mar2022)
}


tests_Intensities_6_out_of_6_Mar2022 <- lapply(colnames(Intensities_6_out_of_6_ready)[-1],function(x) test.fun(Intensities_6_out_of_6_ready,x))
names(tests_Intensities_6_out_of_6_Mar2022) <- colnames(Intensities_6_out_of_6_ready)[-1]
results_Intensities_6_out_of_6_Mar2022 <- do.call(rbind.data.frame, tests_Intensities_6_out_of_6_Mar2022)
write.csv(results_Intensities_6_out_of_6_Mar2022,"/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_results_Intensities_6_out_of_6_Mar2022.csv",row.names = TRUE)

```

```{r}
#Trying another way to do the rank sum test

#1 out of 6
#https://support.bioconductor.org/p/121358/
#https://stackoverflow.com/questions/67049231/run-wilcoxon-rank-sum-test-on-each-row-of-a-data-frame
#p_1_out_of_6 <- apply(Intensities_1_out_of_6[, 2:11], 1, function(x) wilcox.test(x[1:6], x[7:10])$p.value)
#p_1_out_of_6 <- as.data.frame(p_1_out_of_6)
#Same results

```


#Histogram of p-values
```{r}
hist(results_Intensities_1_out_of_6_Mar2022$p, breaks = 20, main="(1 out of 6) Frequency of Wilcoxon Rank Sum Test P-values \nComparing KO with WT Mass Intensities from TVkitMar2022 protein", xlab = "P-value from Wilcoxon Rank Sum Test", ylab = "Frequency of Genes", labels=TRUE) 

#1 out of 6
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_Histogram_Wilcoxon_Intensities_1_out_of_6_MassSpec_Mar2022TV.pdf")
hist(results_Intensities_1_out_of_6_Mar2022$p, breaks = 20, main="(1 out of 6) Frequency of Wilcoxon Rank Sum Test P-values \nComparing KO with WT Mass Intensities from TVkitMar2022 protein", xlab = "P-value from Wilcoxon Rank Sum Test", ylab = "Frequency of Genes", labels=TRUE)
dev.off()

#2 out of 6
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_Histogram_Wilcoxon_Intensities_2_out_of_6_MassSpec_Mar2022TV.pdf")
hist(results_Intensities_2_out_of_6_Mar2022$p, breaks = 20, main="(2 out of 6) Frequency of Wilcoxon Rank Sum Test P-values \nComparing KO with WT Mass Intensities from TVkitMar2022 protein", xlab = "P-value from Wilcoxon Rank Sum Test", ylab = "Frequency of Genes", labels=TRUE)
dev.off()

#3 out of 6
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_Histogram_Wilcoxon_Intensities_3_out_of_6_MassSpec_Mar2022TV.pdf")
hist(results_Intensities_3_out_of_6_Mar2022$p, breaks = 20, main="(3 out of 6) Frequency of Wilcoxon Rank Sum Test P-values \nComparing KO with WT Mass Intensities from TVkitMar2022 protein", xlab = "P-value from Wilcoxon Rank Sum Test", ylab = "Frequency of Genes", labels=TRUE)
dev.off()

#4 out of 6
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_Histogram_Wilcoxon_Intensities_4_out_of_6_MassSpec_Mar2022TV.pdf")
hist(results_Intensities_1_out_of_6_Mar2022$p, breaks = 20, main="(1 out of 6) Frequency of Wilcoxon Rank Sum Test P-values \nComparing KO with WT Mass Intensities from TVkitMar2022 protein", xlab = "P-value from Wilcoxon Rank Sum Test", ylab = "Frequency of Genes", labels=TRUE)
dev.off()

#5 out of 6
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_Histogram_Wilcoxon_Intensities_1_out_of_6_MassSpec_Mar2022TV.pdf")
hist(results_Intensities_1_out_of_6_Mar2022$p, breaks = 20, main="(1 out of 6) Frequency of Wilcoxon Rank Sum Test P-values \nComparing KO with WT Mass Intensities from TVkitMar2022 protein", xlab = "P-value from Wilcoxon Rank Sum Test", ylab = "Frequency of Genes", labels=TRUE)
dev.off()

#6 out of 6
pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_04_07_Histogram_Wilcoxon_Intensities_1_out_of_6_MassSpec_Mar2022TV.pdf")
hist(results_Intensities_1_out_of_6_Mar2022$p, breaks = 20, main="(1 out of 6) Frequency of Wilcoxon Rank Sum Test P-values \nComparing KO with WT Mass Intensities from TVkitMar2022 protein", xlab = "P-value from Wilcoxon Rank Sum Test", ylab = "Frequency of Genes", labels=TRUE)
dev.off()



```

#Grabbing genes that have large fold changes and making ggplots of them with t-tests and wilcoxon test
```{r}
#1 out of 6
Logratio_filteredgenes_1_out_of_6 <- dplyr::filter(Intensities_ratio_check_1_out_of_6_nonzero, logratio_mean > 0.68)
genes_Logratio_filtered_1_out_of_6 <- Logratio_filteredgenes_1_out_of_6$gene
pattern_to_search_logratio_1outof6 <- paste0(genes_Logratio_filtered_1_out_of_6, collapse = "$|^")
pattern_to_search_logratio_1outof6 <- paste("^", pattern_to_search_logratio_1outof6,"$",sep="")
Intensities_logratio_1_out_of_6 <- Intensities_ratio_check_1_out_of_6[grepl(pattern_to_search_logratio_1outof6, Intensities_ratio_check_1_out_of_6$gene),]
Intensities_logratio_1_out_of_6_ready <- as.data.frame(t(Intensities_logratio_1_out_of_6))
Intensities_logratio_1_out_of_6_ready<- cbind(Intensities_newcol,Intensities_logratio_1_out_of_6_ready)
Intensities_logratio_1_out_of_6_ready<-Intensities_logratio_1_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_logratio_1_out_of_6_ready[] <- lapply(Intensities_logratio_1_out_of_6_ready, type.convert, as.is = TRUE)
melted_Intensities_logratio_1_out_of_6_ready = melt(Intensities_logratio_1_out_of_6_ready)

for (var in melted_Intensities_logratio_1_out_of_6_ready$variable) { 
 
  pdf(paste("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall/2022_04_08_logratio_cutoff_genes_1_out_of_6//", var, "_ratiocutoff.pdf", sep=""))
  print(ggboxplot(melted_Intensities_logratio_1_out_of_6_ready[melted_Intensities_logratio_1_out_of_6_ready$variable==var,],x="genotype",y="value",fill="#00AFBB",line.color ="gray")+ggtitle(var)+stat_compare_means(label.x = 0.5))
  dev.off()
  }


#2 out of 6
Logratio_filteredgenes_2_out_of_6 <- dplyr::filter(Intensities_ratio_check_2_out_of_6_nonzero, logratio_mean > 0.68)
genes_Logratio_filtered_2_out_of_6 <- Logratio_filteredgenes_2_out_of_6$gene
pattern_to_search_logratio_2outof6 <- paste0(genes_Logratio_filtered_2_out_of_6, collapse = "$|^")
pattern_to_search_logratio_2outof6 <- paste("^", pattern_to_search_logratio_2outof6,"$",sep="")
Intensities_logratio_2_out_of_6 <- Intensities_ratio_check_2_out_of_6[grepl(pattern_to_search_logratio_2outof6, Intensities_ratio_check_2_out_of_6$gene),]
Intensities_logratio_2_out_of_6_ready <- as.data.frame(t(Intensities_logratio_2_out_of_6))
Intensities_logratio_2_out_of_6_ready<- cbind(Intensities_newcol,Intensities_logratio_2_out_of_6_ready)
Intensities_logratio_2_out_of_6_ready<-Intensities_logratio_2_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_logratio_2_out_of_6_ready[] <- lapply(Intensities_logratio_2_out_of_6_ready, type.convert, as.is = TRUE)
melted_Intensities_logratio_2_out_of_6_ready = melt(Intensities_logratio_2_out_of_6_ready)

for (var in melted_Intensities_logratio_2_out_of_6_ready$variable) { 
 
  pdf(paste("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall/2022_04_08_logratio_cutoff_genes_2_out_of_6//", var, "_ratiocutoff.pdf", sep=""))
  print(ggboxplot(melted_Intensities_logratio_2_out_of_6_ready[melted_Intensities_logratio_2_out_of_6_ready$variable==var,],x="genotype",y="value",fill="#00AFBB",line.color ="gray")+ggtitle(var)+stat_compare_means(label.x = 0.5))
  dev.off()
  }


#3 out of 6
Logratio_filteredgenes_3_out_of_6 <- dplyr::filter(Intensities_ratio_check_3_out_of_6_nonzero, logratio_mean > 0.68)
genes_Logratio_filtered_3_out_of_6 <- Logratio_filteredgenes_3_out_of_6$gene
pattern_to_search_logratio_3outof6 <- paste0(genes_Logratio_filtered_3_out_of_6, collapse = "$|^")
pattern_to_search_logratio_3outof6 <- paste("^", pattern_to_search_logratio_3outof6,"$",sep="")
Intensities_logratio_3_out_of_6 <- Intensities_ratio_check_3_out_of_6[grepl(pattern_to_search_logratio_3outof6, Intensities_ratio_check_3_out_of_6$gene),]
Intensities_logratio_3_out_of_6_ready <- as.data.frame(t(Intensities_logratio_3_out_of_6))
Intensities_logratio_3_out_of_6_ready<- cbind(Intensities_newcol,Intensities_logratio_3_out_of_6_ready)
Intensities_logratio_3_out_of_6_ready<-Intensities_logratio_3_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_logratio_3_out_of_6_ready[] <- lapply(Intensities_logratio_3_out_of_6_ready, type.convert, as.is = TRUE)
melted_Intensities_logratio_3_out_of_6_ready = melt(Intensities_logratio_3_out_of_6_ready)

for (var in melted_Intensities_logratio_3_out_of_6_ready$variable) { 
 
  pdf(paste("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall/2022_04_08_logratio_cutoff_genes_3_out_of_6//", var, "_ratiocutoff.pdf", sep=""))
  print(ggboxplot(melted_Intensities_logratio_3_out_of_6_ready[melted_Intensities_logratio_3_out_of_6_ready$variable==var,],x="genotype",y="value",fill="#00AFBB",line.color ="gray")+ggtitle(var)+stat_compare_means(label.x = 0.5))
  dev.off()
  }


#4 out of 6
Logratio_filteredgenes_4_out_of_6 <- dplyr::filter(Intensities_ratio_check_4_out_of_6_nonzero, logratio_mean > 0.68)
genes_Logratio_filtered_4_out_of_6 <- Logratio_filteredgenes_4_out_of_6$gene
pattern_to_search_logratio_4outof6 <- paste0(genes_Logratio_filtered_4_out_of_6, collapse = "$|^")
pattern_to_search_logratio_4outof6 <- paste("^", pattern_to_search_logratio_4outof6,"$",sep="")
Intensities_logratio_4_out_of_6 <- Intensities_ratio_check_4_out_of_6[grepl(pattern_to_search_logratio_4outof6, Intensities_ratio_check_4_out_of_6$gene),]
Intensities_logratio_4_out_of_6_ready <- as.data.frame(t(Intensities_logratio_4_out_of_6))
Intensities_logratio_4_out_of_6_ready<- cbind(Intensities_newcol,Intensities_logratio_4_out_of_6_ready)
Intensities_logratio_4_out_of_6_ready<-Intensities_logratio_4_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_logratio_4_out_of_6_ready[] <- lapply(Intensities_logratio_4_out_of_6_ready, type.convert, as.is = TRUE)
melted_Intensities_logratio_4_out_of_6_ready = melt(Intensities_logratio_4_out_of_6_ready)

for (var in melted_Intensities_logratio_4_out_of_6_ready$variable) { 
 
  pdf(paste("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall/2022_04_08_logratio_cutoff_genes_4_out_of_6//", var, "_ratiocutoff.pdf", sep=""))
  print(ggboxplot(melted_Intensities_logratio_4_out_of_6_ready[melted_Intensities_logratio_4_out_of_6_ready$variable==var,],x="genotype",y="value",fill="#00AFBB",line.color ="gray")+ggtitle(var)+stat_compare_means(label.x = 0.5))
  dev.off()
  }

#5 out of 6
Logratio_filteredgenes_5_out_of_6 <- dplyr::filter(Intensities_ratio_check_5_out_of_6_nonzero, logratio_mean > 0.68)
genes_Logratio_filtered_4_out_of_6 <- Logratio_filteredgenes_4_out_of_6$gene
pattern_to_search_logratio_4outof6 <- paste0(genes_Logratio_filtered_4_out_of_6, collapse = "$|^")
pattern_to_search_logratio_4outof6 <- paste("^", pattern_to_search_logratio_4outof6,"$",sep="")
Intensities_logratio_4_out_of_6 <- Intensities_ratio_check_4_out_of_6[grepl(pattern_to_search_logratio_4outof6, Intensities_ratio_check_4_out_of_6$gene),]
Intensities_logratio_4_out_of_6_ready <- as.data.frame(t(Intensities_logratio_4_out_of_6))
Intensities_logratio_4_out_of_6_ready<- cbind(Intensities_newcol,Intensities_logratio_4_out_of_6_ready)
Intensities_logratio_4_out_of_6_ready<-Intensities_logratio_4_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_logratio_4_out_of_6_ready[] <- lapply(Intensities_logratio_4_out_of_6_ready, type.convert, as.is = TRUE)
melted_Intensities_logratio_4_out_of_6_ready = melt(Intensities_logratio_4_out_of_6_ready)

for (var in melted_Intensities_logratio_4_out_of_6_ready$variable) { 
 
  pdf(paste("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall/2022_04_08_logratio_cutoff_genes_4_out_of_6//", var, "_ratiocutoff.pdf", sep=""))
  print(ggboxplot(melted_Intensities_logratio_4_out_of_6_ready[melted_Intensities_logratio_4_out_of_6_ready$variable==var,],x="genotype",y="value",fill="#00AFBB",line.color ="gray")+ggtitle(var)+stat_compare_means(label.x = 0.5))
  dev.off()
  }


#6 out of 6
Logratio_filteredgenes_6_out_of_6 <- dplyr::filter(Intensities_ratio_check_6_out_of_6_nonzero, logratio_mean > 0.68)
genes_Logratio_filtered_6_out_of_6 <- Logratio_filteredgenes_6_out_of_6$gene
pattern_to_search_logratio_6outof6 <- paste0(genes_Logratio_filtered_6_out_of_6, collapse = "$|^")
pattern_to_search_logratio_6outof6 <- paste("^", pattern_to_search_logratio_6outof6,"$",sep="")
Intensities_logratio_6_out_of_6 <- Intensities_ratio_check_6_out_of_6[grepl(pattern_to_search_logratio_6outof6, Intensities_ratio_check_6_out_of_6$gene),]
Intensities_logratio_6_out_of_6_ready <- as.data.frame(t(Intensities_logratio_6_out_of_6))
Intensities_logratio_6_out_of_6_ready<- cbind(Intensities_newcol,Intensities_logratio_6_out_of_6_ready)
Intensities_logratio_6_out_of_6_ready<-Intensities_logratio_6_out_of_6_ready %>% row_to_names (row_number= 1) %>% clean_names()
Intensities_logratio_6_out_of_6_ready[] <- lapply(Intensities_logratio_6_out_of_6_ready, type.convert, as.is = TRUE)
melted_Intensities_logratio_6_out_of_6_ready = melt(Intensities_logratio_6_out_of_6_ready)

for (var in melted_Intensities_logratio_6_out_of_6_ready$variable) { 
 
  pdf(paste("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall/2022_04_08_logratio_cutoff_genes_6_out_of_6//", var, "_ratiocutoff.pdf", sep=""))
  print(ggboxplot(melted_Intensities_logratio_6_out_of_6_ready[melted_Intensities_logratio_6_out_of_6_ready$variable==var,],x="genotype",y="value",fill="#00AFBB",line.color ="gray")+ggtitle(var)+stat_compare_means(label.x = 0.5)+stat_compare_means(method = "t.test"))
  dev.off()
  }

```




#Genes Below 0.05 and 0.10 p-value
#Feel free to change the names and the pvalue cutoffs
```{r}
results_Intensities_Mar2022 <- results_Intensities_Mar2022 %>% 
  mutate(significance = ifelse(p < 0.05, "very",
                          ifelse(p < 0.10, "significant", "not")))

significant <- c("very", "significant")
pattern_to_search <- paste0(significant, collapse = "|")

significantIntensities_Mar2022_genes <- results_Intensities_Mar2022[grepl(pattern_to_search, results_Intensities_Mar2022$significance), ]

results_Intensities_Mar2022withJan2022 <- results_Intensities_Mar2022withJan2022%>% 
  mutate(significance = ifelse(p < 0.05, "very",
                          ifelse(p < 0.10, "significant", "not")))

significant_Intensities_Mar2022withJan2022_genes <- results_Intensities_Mar2022withJan2022[grepl(pattern_to_search, results_Intensities_Mar2022withJan2022$significance), ]

```

#Want to do a quick check with Isabela's Data (only significant genes)
```{r}
quick_sig_genes_intensities_SucGrad_Mar2022 <- read_csv("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_IsabelasGradientsFirreWTKO/significant_genes_wilcoxonresults_protein_Intensities.csv") %>% clean_names()
names(quick_sig_genes_intensities_SucGrad_Mar2022)[names(quick_sig_genes_intensities_SucGrad_Mar2022) == "x1"] <- "gene"

quick_sig_genes_intensities_Mar2022 <- significantIntensities_Mar2022_genes
quick_sig_genes_intensities_Mar2022$gene <- row.names(significantIntensities_Mar2022_genes)

quick_sig_genes_intensities_Mar2022withJan2022 <- significant_Intensities_Mar2022withJan2022_genes
quick_sig_genes_intensities_Mar2022withJan2022$gene <- row.names(significant_Intensities_Mar2022withJan2022_genes)

#quick_sig_genes_intensities_Jan2022 <- read_csv("/file/path") %>% clean_names()
#names(quick_sig_genes_intensities_Jan2022)[names(quick_sig_genes_intensities_Jan2022) == "x1"] <- "gene"

significant_intensities_genes1 <- list(genes_ChIRP_Mar2022 = sort(quick_sig_genes_intensities_Mar2022$gene), genes_SucGrad_Mar2022= sort(quick_sig_genes_intensities_SucGrad_Mar2022$gene))
pdf("VennDiagram_SigGenes_ChIRPMar2022_SucGradMar2022.pdf")
ggvenn(significant_intensities_genes1, c("genes_ChIRP_Mar2022","genes_SucGrad_Mar2022"))
dev.off()

significant_intensities_genes2 <- list(genes_ChIRP_Mar_Jan2022 = sort(quick_sig_genes_intensities_Mar2022withJan2022$gene), genes_SucGrad_Mar2022= sort(quick_sig_genes_intensities_SucGrad_Mar2022$gene))
pdf("VennDiagram_SigGenes_ChIRPMarJan2022_SucGradMar2022.pdf")
ggvenn(significant_intensities_genes2, c("genes_ChIRP_Mar_Jan2022","genes_SucGrad_Mar2022"))
dev.off()


composite_genes_SucGrad_ChIRPMar2022 <- inner_join(quick_sig_genes_intensities_SucGrad_Mar2022, quick_sig_genes_intensities_Mar2022, by = "gene")
write.csv(composite_genes_SucGrad_ChIRPMar2022, file = "composite_genes_SucGrad_ChIRPMar2022.csv", row.names=TRUE)
```



##will need to change the gene names below that I put in manually
##make sure genotype entry is the same as above
#Pvalues are on individual graphs, but not the big graph. 
#Graphs here are fancy and pretty close to publication ready. 
#Feel free to change the fill color. It's teal. 
```{r}
#genes with pvalues <0.05. Making Box Whisker Plots, both all together and individual

#Spectral
#in the future I might have to grep these names
sig_intensity_Mar2022_genes <- quick_sig_genes_intensities_Mar2022$gene
pattern_to_search_sig_Mar2022_genes <- paste0(sig_intensity_Mar2022_genes, collapse = "$|^")
pattern_to_search_sig_Mar2022_genes <- paste("^",pattern_to_search_sig_Mar2022_genes, "$", sep ="")
long_data_intensities_Mar2022_sig_genes <- Intensities_valid[, grep(pattern_to_search_sig_Mar2022_genes, colnames(Intensities_valid))]
genotype_search <- c("WT","WT","WT","WT","WT","WT","KO","KO","KO","KO")
long_data_intensities_Mar2022_sig_genes <- cbind(genotype_search,long_data_intensities_Mar2022_sig_genes)
mm_sig_intensities_Mar2022 = melt(long_data_intensities_Mar2022_sig_genes)

  #pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_03_31_sig_genes_Spectral_boxwhisker_Wilcoxon_S_MassSpec_Mar2022TV_v_Jan2022TV.pdf")
 # ggplot(mm_sigSpectral)+geom_boxplot(aes(x=genotype, y=value),fill = "#00AFBB")+facet_grid(.~variable)
  #dev.off()


for (var in mm_sig_intensities_Mar2022$variable) { 
 
  pdf(paste("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall/2022_03_28_MassSpec_Intensities_Mar2022_BoxPlots_SignificantGenes//", var, "_sig.pdf", sep=""))
  print(ggpaired(mm_sig_intensities_Mar2022[mm_sig_intensities_Mar2022$variable==var,],x="genotype_search",y="value",fill="#00AFBB",line.color ="gray")+ggtitle(var)+stat_compare_means(label.x = 0.5))
  dev.off()
  }

#Intensities of Mar 2022 and Jan 2022
sig_intensity_Jan_Mar2022_genes <- quick_sig_genes_intensities_Mar2022withJan2022$gene
pattern_to_search_sig_Jan_Mar2022_genes <- paste0(sig_intensity_Jan_Mar2022_genes, collapse = "$|^")
pattern_to_search_sig_Jan_Mar2022_genes <- paste("^",pattern_to_search_sig_Jan_Mar2022_genes, "$", sep ="")
long_data_intensities_Jan_Mar2022_sig_genes <- Intensities_valid_withJan2022[, grep(pattern_to_search_sig_Jan_Mar2022_genes, colnames(Intensities_valid_withJan2022))]
genotype_Jan_Mar_2022 <- c("WT","WT","WT","WT","WT","WT","WT","WT","KO","KO","KO","KO","KO","KO")
long_data_intensities_Jan_Mar2022_sig_genes <- cbind(genotype_Jan_Mar_2022,long_data_intensities_Jan_Mar2022_sig_genes)
mm_sig_intensities_Jan_Mar2022 = melt(long_data_intensities_Jan_Mar2022_sig_genes)

pdf("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//2022_03_31_sig_genes_Jan_Mar2022_Intensities_boxwhisker_Wilcoxon_MassSpec_Mar2022TV_v_Jan2022TV.pdf")
ggplot(mm_sig_intensities_Jan_Mar2022)+geom_boxplot(aes(x=genotype_Jan_Mar_2022, y=value),fill = "#00AFBB")+facet_grid(.~variable)
dev.off()

for (var in mm_sig_intensities_Jan_Mar2022$variable) { 
             
  pdf(paste("/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall/2022_03_28_MassSpec_Intensities_Jan_Mar_2022_BoxPlots_SignificantGenes//", var, "_sig.pdf", sep=""))
  #print(ggplot(mm_sigIntensities[mm_sigIntensities$variable==var,])+geom_boxplot(aes(x=genotype, y=value),fill="#00AFBB")+ggtitle(var))
  print(ggpaired(mm_sig_intensities_Jan_Mar2022[mm_sig_intensities_Jan_Mar2022$variable==var,],x="genotype_Jan_Mar_2022",y="value",fill="#00AFBB",line.color ="gray")+ggtitle(var)+stat_compare_means(label.x = 0.5))
  dev.off()
}

#Trying to add pvalues to plots.
#Help websites
#https://www.datanovia.com/en/blog/ggpubr-how-to-add-p-values-generated-elsewhere-to-a-ggplot/
#https://www.r-bloggers.com/2017/06/add-p-values-and-significance-levels-to-ggplots/
#http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/76-add-p-values-and-significance-levels-to-ggplots/
```

```{r}
write.csv(quick_sig_genes_intensities_Mar2022,"/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//pvalues_Mar2022ChIRP_Siggenes.csv",row.names = TRUE)
write.csv(quick_sig_genes_intensities_Mar2022withJan2022,"/scratch/Shares/rinn/tenaya/ChChCh/2022_03_28_MassSpec_ChIRP_TVall//pvalues_Jan_Mar2022ChIRP_Siggenes.csv",row.names = TRUE)
```


##Then comes histograms of the spectral and intensities counts
##Also more fancy box plots of the very interesting genes